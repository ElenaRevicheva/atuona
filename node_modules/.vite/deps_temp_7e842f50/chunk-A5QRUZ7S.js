import {
  getFromMockStorage
} from "./chunk-A2CDDISI.js";
import {
  resolveScheme
} from "./chunk-MW5FLPJ5.js";
import {
  IS_TEST,
  getClientFetch
} from "./chunk-L7Y3EIPZ.js";

// node_modules/thirdweb/dist/esm/storage/download.js
async function download(options) {
  var _a, _b, _c, _d, _e, _f, _g, _h, _i;
  if (IS_TEST) {
    const hash = options.uri.split("://")[1];
    if (!hash) {
      throw new Error("Invalid hash");
    }
    const data = getFromMockStorage(hash);
    if (data) {
      return {
        json: () => Promise.resolve(data),
        ok: true,
        status: 200
      };
    }
  }
  let url;
  if (options.uri.startsWith("ar://")) {
    const { resolveArweaveScheme } = await import("./arweave-VHRHGFUY.js");
    url = resolveArweaveScheme(options);
  } else {
    url = resolveScheme(options);
  }
  const res = await getClientFetch(options.client)(url, {
    headers: (_c = (_b = (_a = options.client.config) == null ? void 0 : _a.storage) == null ? void 0 : _b.fetch) == null ? void 0 : _c.headers,
    keepalive: (_f = (_e = (_d = options.client.config) == null ? void 0 : _d.storage) == null ? void 0 : _e.fetch) == null ? void 0 : _f.keepalive,
    requestTimeoutMs: options.requestTimeoutMs ?? ((_i = (_h = (_g = options.client.config) == null ? void 0 : _g.storage) == null ? void 0 : _h.fetch) == null ? void 0 : _i.requestTimeoutMs) ?? 6e4
  });
  if (!res.ok) {
    const error = await res.text();
    throw new Error(`Failed to download file: ${res.status} ${res.statusText} ${error || ""}`);
  }
  return res;
}

export {
  download
};
//# sourceMappingURL=chunk-A5QRUZ7S.js.map
