const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-Df2fo2H_.js","assets/_commonjsHelpers-BosuxZz1.js","assets/main-DAjelYsw.js"])))=>i.map(i=>d[i]);
import{B as F,s as x,a as U,g as A,n as D,b as y,_ as G,c as T,f as Q,d as N,e as _,p as X,h as Z,v as O,i as H,j as ee,u as ne,k as $,t as ae}from"./main-DAjelYsw.js";const te=e=>e;class ie extends F{constructor({body:a,error:t,url:i}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${te(i)}`,`Request body: ${x(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code,this.data=t.data}}const ce=-1;class re extends F{constructor(a,{code:t,docsPath:i,metaMessages:n,name:s,shortMessage:o}){super(o,{cause:a,docsPath:i,metaMessages:n||(a==null?void 0:a.metaMessages),name:s||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=s||a.name,this.code=a instanceof ie?a.code:t??ce}}class W extends re{constructor(a,t){super(a,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class P extends W{constructor(a){super(a,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class E extends W{constructor(a){super(a,{code:E.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(E,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const se="08c4b07e3ad25f1a27c14a4e8cecb6f0",J="eip155",R="tw:connected-wallet-params";async function oe(e,a,t){if(!ue(t))throw new Error("given params are not stringifiable");const i=await e.getItem(R);let n;if(i){try{n=JSON.parse(i)}catch{n={}}n[a]=t}else n={[a]:t};e.setItem(R,U(n))}async function de(e,a){const t=await e.getItem(R);if(!t)return null;try{const i=JSON.parse(t);return i!=null&&i[a]?i[a]:null}catch{return null}}function ue(e){try{return U(e),!0}catch{return!1}}let w=null;const q={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function me(e,a,t,i,n){var v,M,S;const s=await V(e,t,n),o=e.walletConnect;let{onDisplayUri:c}=o||{};const r=await A(t);!c&&n&&(c=j=>{const L=r.mobile.native||r.mobile.universal;if(!L){n(j);return}const Y=Q(L,j).redirect;n(Y)}),c&&s.events.addListener("display_uri",c);let l=o==null?void 0:o.optionalChains,d=e.chain;t==="global.safe"&&(l=K.map(y),d&&!l.includes(d)&&(d=void 0));const{chains:h,rpcMap:m}=he({chain:d,client:e.client,optionalChains:l});await s.connect({...o!=null&&o.pairingTopic?{pairingTopic:o==null?void 0:o.pairingTopic}:{},namespaces:{[J]:{chains:h,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:m}}}),B(h.map(b=>Number(b.split(":")[1])),i);const u=((v=h[0])==null?void 0:v.split(":")[1])||1,f=D(u),p=(await s.request({method:"eth_requestAccounts",params:[]},`eip155:${f}`))[0];if(!p)throw new Error("No accounts found on provider.");const C=e.chain&&e.chain.id===f?e.chain:y(f);if(e){const b={chain:e.chain,optionalChains:(M=e.walletConnect)==null?void 0:M.optionalChains,pairingTopic:(S=e.walletConnect)==null?void 0:S.pairingTopic};i&&oe(i,t,b)}return c&&s.events.removeListener("display_uri",c),z(p,C,s,a,i,e.client,r,n)}async function pe(e,a,t,i,n){var u,f,g,p,C;const s=i?await de(i,t):null,o=await A(t),c=await V(s?{chain:s.chain,client:e.client,walletConnect:{optionalChains:s.optionalChains,pairingTopic:s.pairingTopic}}:{client:e.client,walletConnect:{}},t,n);if(!c.session)throw await c.disconnect(),new Error("No wallet connect session found on provider.");const r=(g=(f=(u=c.session)==null?void 0:u.namespaces)==null?void 0:f[J])==null?void 0:g.accounts,l=(p=r==null?void 0:r[0])==null?void 0:p.split(":")[2];if(!l)throw new Error("No accounts found on provider.");const d=((C=e.chain)==null?void 0:C.id)||1,h=D(d),m=e.chain&&e.chain.id===h?e.chain:y(h);return z(l,m,c,a,i,e.client,o,n)}async function V(e,a,t){var l,d,h,m;if(w)return w;const i=await A(a),n=e.walletConnect,{UniversalProvider:s}=await G(async()=>{const{UniversalProvider:u}=await import("./index.es-Df2fo2H_.js").then(f=>f.k);return{UniversalProvider:u}},__vite__mapDeps([0,1,2]));let o=n==null?void 0:n.optionalChains,c=e.chain;a==="global.safe"&&(o=K.map(y),c&&!o.includes(c)&&(c=void 0));const r=await s.init({metadata:{description:((l=n==null?void 0:n.appMetadata)==null?void 0:l.description)||T().description,icons:[((d=n==null?void 0:n.appMetadata)==null?void 0:d.logoUrl)||T().logoUrl],name:((h=n==null?void 0:n.appMetadata)==null?void 0:h.name)||T().name,url:((m=n==null?void 0:n.appMetadata)==null?void 0:m.url)||T().url,redirect:{native:i.mobile.native||void 0,universal:i.mobile.universal||void 0}},projectId:(n==null?void 0:n.projectId)||se});if(r.events.setMaxListeners(Number.POSITIVE_INFINITY),a!=="walletConnect"){async function u(){var g,p,C,v;const f=((v=(C=(p=(g=r.session)==null?void 0:g.peer)==null?void 0:p.metadata)==null?void 0:C.redirect)==null?void 0:v.native)||i.mobile.native||i.mobile.universal;t&&f&&await t(f)}r.on("session_request_sent",u),r.events.addListener("disconnect",()=>{r.off("session_request_sent",u),w=null})}return w=r,r}function k({provider:e,address:a,client:t,chain:i,sessionRequestHandler:n,walletInfo:s}){return{address:_(a),async sendTransaction(c){const r=await I({provider:e,payload:{method:"eth_sendTransaction",params:[{data:c.data,from:_(a),gas:c.gas?$(c.gas):void 0,to:c.to,value:c.value?$(c.value):void 0}]},chain:`eip155:${c.chainId}`,walletInfo:s,sessionRequestHandler:n});return ae({chainId:c.chainId,client:t,contractAddress:c.to??void 0,gasPrice:c.gasPrice,transactionHash:r,walletAddress:_(a),walletType:"walletConnect"}),{transactionHash:r}},async signMessage({message:c}){const r=typeof c=="string"?ee(c):c.raw instanceof Uint8Array?ne(c.raw):c.raw;return I({provider:e,payload:{method:"personal_sign",params:[r,this.address]},chain:`eip155:${i.id}`,walletInfo:s,sessionRequestHandler:n})},async signTypedData(c){const r=X(c),{domain:l,message:d,primaryType:h}=r,m={EIP712Domain:Z({domain:l}),...r.types};O({domain:l,message:d,primaryType:h,types:m});const u=H({domain:l??{},message:d,primaryType:h,types:m});return await I({provider:e,payload:{method:"eth_signTypedData_v4",params:[this.address,u]},chain:`eip155:${i.id}`,walletInfo:s,sessionRequestHandler:n})}}}async function I(e){var r,l,d,h;const{provider:a,payload:t,chain:i,walletInfo:n,sessionRequestHandler:s}=e,o=a.request(t,i),c=((h=(d=(l=(r=a.session)==null?void 0:r.peer)==null?void 0:l.metadata)==null?void 0:d.redirect)==null?void 0:h.native)||n.mobile.native||n.mobile.universal;return s&&c&&await s(c),o}function z(e,a,t,i,n,s,o,c){const r=k({address:e,chain:a,client:s,provider:t,sessionRequestHandler:c,walletInfo:o});async function l(){t.removeListener("accountsChanged",h),t.removeListener("chainChanged",m),t.removeListener("disconnect",d),await t.disconnect(),w=null}function d(){B([],n),n==null||n.removeItem(q.lastUsedChainId),l(),i.emit("disconnect",void 0)}function h(u){if(u[0]){const f=k({address:_(u[0]),chain:a,client:s,provider:t,sessionRequestHandler:c,walletInfo:o});i.emit("accountChanged",f),i.emit("accountsChanged",u)}else d()}function m(u){const f=y(D(u));i.emit("chainChanged",f),n==null||n.setItem(q.lastUsedChainId,String(u))}return t.on("accountsChanged",h),t.on("chainChanged",m),t.on("disconnect",d),t.on("session_delete",d),[r,a,l,u=>le(t,u)]}async function le(e,a){const t=a.id;try{e.setDefaultChain(`eip155:${t}`)}catch(i){const n=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(n)?new P(i):new E(i)}}function B(e,a){a==null||a.setItem(q.requestedChains,U(e))}function he(e){const a={},t=[];e.chain&&(a[e.chain.id]=N({chain:e.chain,client:e.client}),t.push(e.chain.id));const i=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const n of i)a[n.id]=N({chain:n,client:e.client}),t.push(n.id);return!e.chain&&i.length===0&&(a[1]=y(1).rpc,t.push(1)),{chains:t.map(n=>`eip155:${n}`),rpcMap:a}}const K=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{pe as autoConnectWC,me as connectWC};
