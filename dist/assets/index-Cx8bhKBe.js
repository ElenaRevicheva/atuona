const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/signing-DQH2GbYp.js","assets/main-Bom9w5k7.js","assets/concat-hex-BqD5YBIC.js","assets/approve-6IsOU4_X.js","assets/send-eip712-transaction-QUAtm_r3.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/sha256-uuPYgk2x.js","assets/number-DhiSQStc.js","assets/in-app-wallet-calls-CHSckKlf.js","assets/send-batch-transaction-W3abJwWU.js"])))=>i.map(i=>d[i]);
import{_ as L,aP as dt,a6 as b,af as U,ag as mt,aC as ut,bB as W,Z as K,bf as z,bC as pt,ab as Z,q as j,bD as _,C as O,b3 as D,bE as Y,bF as lt,bG as C,bH as yt,k as J,a4 as S,bI as k,a2 as H,r as x,aK as ft,bJ as wt,bK as At,bL as ht,bM as gt,bN as Gt,a as P,ad as Tt,a8 as vt,b4 as Pt,bO as Lt,bP as F,bQ as Q,bR as X,bS as xt,bT as Ot,ay as Dt,g as tt,l as Ct,e as E,bU as bt,bV as St,w as I,b5 as _t,bW as Et,bX as Ft,bY as It,bZ as Vt}from"./main-Bom9w5k7.js";import{b as Ut,a as Nt}from"./approve-6IsOU4_X.js";import{t as $t,p as Rt,s as kt}from"./send-eip712-transaction-QUAtm_r3.js";function Ht(t){return Ut({asyncParams:async()=>{let n;if("amount"in t){const{decimals:e}=await L(async()=>{const{decimals:r}=await import("./main-Bom9w5k7.js").then(s=>s.eT);return{decimals:r}},[]),i=await e(t).catch(()=>18);n=dt(t.amount.toString(),i)}else n=t.amountWei;return{overrides:{erc20Value:{amountWei:n,tokenAddress:t.contract.address}},spender:t.spender,value:n}},contract:t.contract})}const Bt="0xf15d424e",Mt=[{name:"signer",type:"address"}],qt=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function Wt(t){return b({contract:t.contract,method:[Bt,Mt,qt],params:[t.signer]})}const Kt="0x5892e236",zt=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],Zt=[];function jt(t){const n=mt(async()=>"asyncParams"in t?await t.asyncParams():t);return U({accessList:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.accessList},authorizationList:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.authorizationList},contract:t.contract,erc20Value:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.erc20Value},extraGas:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.extraGas},gas:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.gas},gasPrice:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.gasPrice},maxFeePerGas:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.maxFeePerGas},maxPriorityFeePerGas:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.maxPriorityFeePerGas},method:[Kt,zt,Zt],nonce:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.nonce},params:async()=>{const e=await n();return[e.req,e.signature]},value:async()=>{var e;return(e=(await n()).overrides)==null?void 0:e.value}})}function q(){return new Date(Date.now()+1e3*60*60*24*365*10)}function N(t){return $t(Math.floor(t.getTime()/1e3))}const Yt=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function Jt(t){const{account:n,contract:e,req:i}=t,r=await n.signTypedData({domain:{chainId:e.chain.id,name:"Account",verifyingContract:e.address,version:"1"},message:i,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:Yt}});return{req:i,signature:r}}async function Qt(t){var i;const{target:n,permissions:e}=t;return{approvedTargets:e.approvedTargets==="*"?[K]:e.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:W(((i=e.nativeTokenLimitPerTransaction)==null?void 0:i.toString())||"0"),permissionEndTimestamp:N(e.permissionEndTimestamp||q()),permissionStartTimestamp:N(e.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:N(q()),reqValidityStartTimestamp:0n,signer:n,uid:await ut()}}function Xt(t){const{contract:n,sessionKeyAddress:e,account:i,permissions:r}=t;return jt({async asyncParams(){const{req:s,signature:c}=await Jt({account:i,contract:n,req:await Qt({permissions:r,target:e})});return{req:s,signature:c}},contract:n})}async function te(t){var c;const{accountContract:n,sessionKeyAddress:e,newPermissions:i}=t;if(!await z(n))return!0;const s=await Wt({contract:n,signer:e});return!!(s.endTimestamp&&s.endTimestamp<Math.floor(Date.now()/1e3)||!ee(s.approvedTargets,i.approvedTargets)||W(((c=i.nativeTokenLimitPerTransaction)==null?void 0:c.toString())??"0")>s.nativeTokenLimitPerTransaction)}function ee(t,n){return n==="*"&&t.length===1&&t[0]===K?!0:n!=="*"?n.map(e=>e.toLowerCase()).every(e=>t.map(i=>i.toLowerCase()).includes(e)):!1}const ae=2n**96n-1n;async function ne(t){const{factoryContract:n,predictAddressOverride:e,adminAddress:i,accountSalt:r,accountAddress:s}=t;if(e)return e(n,i);if(s)return s;if(!i)throw new Error("Account address is required to predict the smart wallet address.");return pt(async()=>{const c=r&&Z(r)?r:j(r??"");let a,o=0;const d=3;for(;o<=d;)try{a=await b({contract:n,method:"function getAddress(address, bytes) returns (address)",params:[i,c]});break}catch(l){if(o===d)throw l;const y=2**(o+1)*200;await new Promise(m=>setTimeout(m,y)),o++}if(!a)throw new Error(`No smart account address found for admin address ${i} and salt ${r}`);return a},{cacheKey:`${t.factoryContract.chain.id}-${t.factoryContract.address}-${t.adminAddress}-${t.accountSalt}`,cacheTime:1e3*60*60*24})}function et(t){const{adminAddress:n,factoryContract:e,createAccountOverride:i,accountSalt:r}=t;if(i)return i(e,n);const s=r&&Z(r)?r:j(r??"");return U({contract:e,method:"function createAccount(address, bytes) returns (address)",params:[n,s]})}function at(t){const{accountContract:n,transaction:e,executeOverride:i}=t;if(i)return i(n,e);let r=e.value||0n;return(e.chainId===295||e.chainId===296)&&(r=BigInt(r)/BigInt(10**10)),U({contract:n,gas:e.gas?e.gas+21000n:void 0,method:"function execute(address, uint256, bytes)",params:[e.to||"",r,e.data||"0x"]})}function se(t){var c;const{accountContract:n,transactions:e,executeBatchOverride:i}=t;if(i)return i(n,e);let r=e.map(a=>a.value||0n);const s=(c=e[0])==null?void 0:c.chainId;return(s===295||s===296)&&(r=r.map(a=>BigInt(a)/BigInt(10**10))),U({contract:n,method:"function executeBatch(address[], uint256[], bytes[])",params:[e.map(a=>a.to||""),r,e.map(a=>a.data||"0x")]})}const re="0x35567e1a",ie=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],ce=[{name:"nonce",type:"uint256"}];async function oe(t){return b({contract:t.contract,method:[re,ie,ce],params:[t.sender,t.key]})}const de="0xa6193531",me=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],ue=[{type:"bytes32"}];async function pe(t){return b({contract:t.contract,method:[de,me,ue],params:[t.userOp]})}const le="0x22cdde4c",ye=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],fe=[{type:"bytes32"}];async function we(t){return b({contract:t.contract,method:[le,ye,fe],params:[t.userOp]})}function Ae(t){return t.factory?_([t.factory,t.factoryData||"0x"]):"0x"}function he(t){return _([O(D(BigInt(t.verificationGasLimit)),{size:16}),O(D(BigInt(t.callGasLimit)),{size:16})])}function ge(t){return _([O(D(BigInt(t.maxPriorityFeePerGas)),{size:16}),O(D(BigInt(t.maxFeePerGas)),{size:16})])}function Ge(t){return t.paymaster?_([t.paymaster,O(D(BigInt(t.paymasterVerificationGasLimit||0)),{size:16}),O(D(BigInt(t.paymasterPostOpGasLimit||0)),{size:16}),t.paymasterData||"0x"]):"0x"}const Te=t=>({accountGasLimits:he(t),callData:t.callData,gasFees:ge(t),initCode:Ae(t),nonce:BigInt(t.nonce),paymasterAndData:Ge(t),preVerificationGas:BigInt(t.preVerificationGas),sender:t.sender,signature:t.signature});async function V(t){var A;const{userOp:n,paymasterOverride:e,client:i,chain:r,entrypointAddress:s}=t;if(e)return e(n);const c={"Content-Type":"application/json"},a=s??C,o=Y(r),d={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[lt(n),a]},y=await yt(i)(o,{body:J(d),headers:c,method:"POST"});if(!y.ok){const h=await y.text()||y.statusText;throw new Error(`Paymaster error: ${y.status} - ${h}`)}const m=await y.json();if(m.result)return typeof m.result=="string"?{paymasterAndData:m.result}:(m.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${m.result.reason} ${m.result.policyId?`(policyId: ${m.result.policyId})`:""}`),{callGasLimit:m.result.callGasLimit?S(m.result.callGasLimit):void 0,paymaster:m.result.paymaster,paymasterAndData:m.result.paymasterAndData,paymasterData:m.result.paymasterData,paymasterPostOpGasLimit:m.result.paymasterPostOpGasLimit?S(m.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:m.result.paymasterVerificationGasLimit?S(m.result.paymasterVerificationGasLimit):void 0,preVerificationGas:m.result.preVerificationGas?S(m.result.preVerificationGas):void 0,verificationGasLimit:m.result.verificationGasLimit?S(m.result.verificationGasLimit):void 0});const w=((A=m.error)==null?void 0:A.message)||m.error||y.statusText||"unknown error";throw new Error(`Paymaster error from ${o}: ${w}`)}const B=new Set,M=t=>`${t.chain.id}:${t.address}`,nt=t=>{B.add(M(t))},st=t=>{B.delete(M(t))},rt=t=>B.has(M(t));async function ve(t){const n=t.timeoutMs||12e4,e=t.intervalMs||1e3,i=Date.now()+n;for(;Date.now()<i;){const r=await wt(t);if(r)return r;await new Promise(s=>setTimeout(s,e))}throw new Error(`Timeout waiting for userOp to be mined on chain ${t.chain.id} with UserOp hash: ${t.userOpHash}`)}async function Pe(t){var T;const{transaction:n,accountContract:e,factoryContract:i,adminAddress:r,overrides:s,sponsorGas:c,waitForDeployment:a=!0,isDeployedOverride:o}=t,d=n.chain,l=n.client,y={bundlerUrl:s==null?void 0:s.bundlerUrl,chain:d,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress},m=k(((T=t.overrides)==null?void 0:T.entrypointAddress)||C),[w,A,h,g,f]=await Promise.all([typeof o=="boolean"?o:z(e).then(G=>G||rt(e)),H(n),x(n.gas),Le({bundlerOptions:y,chain:d,client:l,executeTx:n}),Se({accountContract:e,chain:d,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:u,maxPriorityFeePerGas:p}=g;return m==="v0.7"?xe({accountContract:e,adminAddress:r,bundlerOptions:y,callData:A,callGasLimit:h,factoryContract:i,isDeployed:w,maxFeePerGas:u,maxPriorityFeePerGas:p,nonce:f,overrides:s,sponsorGas:c,waitForDeployment:a}):Oe({accountContract:e,adminAddress:r,bundlerOptions:y,callData:A,callGasLimit:h,factoryContract:i,isDeployed:w,maxFeePerGas:u,maxPriorityFeePerGas:p,nonce:f,overrides:s,sponsorGas:c,waitForDeployment:a})}async function Le(t){const{executeTx:n,bundlerOptions:e,chain:i,client:r}=t;let{maxFeePerGas:s,maxPriorityFeePerGas:c}=n;const a=(e==null?void 0:e.bundlerUrl)??Y(i);if(At(a)){const o=await ht({options:e});s=o.maxFeePerGas,c=o.maxPriorityFeePerGas}else{const[o,d]=await Promise.all([x(s),x(c)]);if(o&&d)s=o,c=d;else{const l=await gt(r,i);c=d??l.maxPriorityFeePerGas??0n,s=o??l.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:c}}async function xe(t){const{bundlerOptions:n,isDeployed:e,factoryContract:i,accountContract:r,adminAddress:s,sponsorGas:c,overrides:a,nonce:o,callData:d,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:m,waitForDeployment:w}=t,{chain:A,client:h}=n;let g,f;e?(f="0x",w&&await it(r)):(g=i.address,f=await H(et({accountSalt:a==null?void 0:a.accountSalt,adminAddress:s,createAccountOverride:a==null?void 0:a.createAccount,factoryContract:i})),w&&nt(r));const u={callData:d,callGasLimit:l??0n,factory:g,factoryData:f,maxFeePerGas:y,maxPriorityFeePerGas:m,nonce:o,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:r.address,signature:Q,verificationGasLimit:0n};if(c){const p=await V({chain:A,client:h,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster,userOp:u});if(p.paymaster&&p.paymasterData&&(u.paymaster=p.paymaster,u.paymasterData=p.paymasterData),p.callGasLimit&&p.verificationGasLimit&&p.preVerificationGas&&p.paymasterPostOpGasLimit&&p.paymasterVerificationGasLimit)u.callGasLimit=p.callGasLimit,u.verificationGasLimit=p.verificationGasLimit,u.preVerificationGas=p.preVerificationGas,u.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit,u.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit;else{const T=a!=null&&a.tokenPaymaster?{[a.tokenPaymaster.tokenAddress]:{stateDiff:{[Tt(vt([{type:"address"},{type:"uint256"}],[r.address,a.tokenPaymaster.balanceStorageSlot]))]:Pt(Lt,{size:32})}}}:void 0,G=await F({options:n,userOp:u},T);u.callGasLimit=G.callGasLimit,u.verificationGasLimit=G.verificationGasLimit,u.preVerificationGas=G.preVerificationGas,u.paymasterPostOpGasLimit=a!=null&&a.tokenPaymaster?500000n:G.paymasterPostOpGasLimit||0n,u.paymasterVerificationGasLimit=G.paymasterVerificationGasLimit||0n;const v=await V({chain:A,client:h,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster,userOp:u});v.paymaster&&v.paymasterData&&(u.paymaster=v.paymaster,u.paymasterData=v.paymasterData)}}else{const p=await F({options:n,userOp:u});u.callGasLimit=p.callGasLimit,u.verificationGasLimit=p.verificationGasLimit,u.preVerificationGas=p.preVerificationGas,u.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit||0n,u.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit||0n}return{...u,signature:"0x"}}async function Oe(t){const{bundlerOptions:n,isDeployed:e,factoryContract:i,accountContract:r,adminAddress:s,sponsorGas:c,overrides:a,nonce:o,callData:d,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:m,waitForDeployment:w}=t,{chain:A,client:h}=n;let g;e?(g="0x",w&&await it(r)):(g=await be({accountSalt:a==null?void 0:a.accountSalt,adminAddress:s,createAccountOverride:a==null?void 0:a.createAccount,factoryContract:i}),w&&nt(r));const f={callData:d,callGasLimit:l??0n,initCode:g,maxFeePerGas:y,maxPriorityFeePerGas:m,nonce:o,paymasterAndData:"0x",preVerificationGas:0n,sender:r.address,signature:Q,verificationGasLimit:0n};if(c){const u=await V({chain:A,client:h,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster,userOp:f}),p="paymasterAndData"in u?u.paymasterAndData:"0x";if(p&&p!=="0x"&&(f.paymasterAndData=p),u.callGasLimit&&u.verificationGasLimit&&u.preVerificationGas)f.callGasLimit=u.callGasLimit,f.verificationGasLimit=u.verificationGasLimit,f.preVerificationGas=u.preVerificationGas;else{const T=await F({options:n,userOp:f});if(f.callGasLimit=T.callGasLimit,f.verificationGasLimit=T.verificationGasLimit,f.preVerificationGas=T.preVerificationGas,p&&p!=="0x"){const G=await V({chain:A,client:h,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster,userOp:f}),v="paymasterAndData"in G?G.paymasterAndData:"0x";v&&v!=="0x"&&(f.paymasterAndData=v)}}}else{const u=await F({options:n,userOp:f});f.callGasLimit=u.callGasLimit,f.verificationGasLimit=u.verificationGasLimit,f.preVerificationGas=u.preVerificationGas}return{...f,signature:"0x"}}async function De(t){const{userOp:n,chain:e,entrypointAddress:i,adminAccount:r}=t,s=await Ce({chain:e,client:t.client,entrypointAddress:i,userOp:n});if(r.signMessage){const c=await r.signMessage({chainId:e.id,message:{raw:ft(s)},originalMessage:J(n)});return{...n,signature:c}}throw new Error("signMessage not implemented in signingAccount")}async function Ce(t){const{userOp:n,chain:e,entrypointAddress:i}=t,r=k(i||C);let s;if(r==="v0.7"){const c=Te(n);s=await we({contract:P({address:i||X,chain:e,client:t.client}),userOp:c})}else s=await pe({contract:P({address:i||C,chain:e,client:t.client}),userOp:n});return s}async function be(t){const{factoryContract:n,adminAddress:e,accountSalt:i,createAccountOverride:r}=t,s=et({accountSalt:i,adminAddress:e,createAccountOverride:r,factoryContract:n});return _([n.address,await H(s)])}async function Se(t){const{accountContract:n,chain:e,client:i,entrypointAddress:r,getNonceOverride:s}=t;return s?s(n):await oe({contract:P({address:r||C,chain:e,client:i}),key:Gt(),sender:n.address})}async function it(t){const n=Date.now();for(;rt(t);){if(Date.now()-n>6e4)throw st(t),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}const ct=new WeakMap,$=new WeakMap;async function _e(t,n){var m,w,A,h,g,f,u;const{personalAccount:e,client:i}=t;if(!e)throw new Error("No personal account provided for smart account connection");const r=n,s=n.chain,c="gasless"in r?r.gasless:r.sponsorGas;if(await xt(s))return[Ve({chain:s,connectionOptions:t,creationOptions:n,sponsorGas:c}),s];if(r.factoryAddress&&!((m=r.overrides)!=null&&m.entrypointAddress)){const p=await ot(r.factoryAddress,i,s);p&&(r.overrides={...r.overrides,entrypointAddress:p})}(w=r.overrides)!=null&&w.tokenPaymaster&&!((A=r.overrides)!=null&&A.entrypointAddress)&&(r.overrides={...r.overrides,entrypointAddress:X});const a=r.factoryAddress??Ot((h=r.overrides)==null?void 0:h.entrypointAddress),o=P({address:a,chain:s,client:i}),d=await ne({accountAddress:(g=r.overrides)==null?void 0:g.accountAddress,accountSalt:(f=r.overrides)==null?void 0:f.accountSalt,adminAddress:e.address,factoryContract:o,predictAddressOverride:(u=r.overrides)==null?void 0:u.predictAddress}).then(p=>p).catch(p=>{throw new Error(`Failed to get account address with factory contract ${o.address} on chain ID ${s.id}: ${(p==null?void 0:p.message)||"unknown error"}`,{cause:p})}),l=P({address:d,chain:s,client:i}),y=await Fe({...r,accountContract:l,chain:s,client:i,factoryContract:o,personalAccount:e,sponsorGas:c});if(ct.set(e,y),$.set(y,e),r.sessionKey&&await te({accountContract:l,newPermissions:r.sessionKey.permissions,sessionKeyAddress:r.sessionKey.address})){const p=Xt({account:e,contract:l,permissions:r.sessionKey.permissions,sessionKeyAddress:r.sessionKey.address});await Dt({account:y,transaction:p})}return[y,s]}async function Ee(t){const n=$.get(t);n&&(ct.delete(n),$.delete(t))}async function Fe(t){var s,c;const n=(s=t.overrides)==null?void 0:s.tokenPaymaster;if(n&&k(((c=t.overrides)==null?void 0:c.entrypointAddress)||C)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");const e=t.sponsorGas;let i=t.accountContract;const r={address:tt(i.address),async onTransactionRequested(a){var o,d;return(d=(o=t.personalAccount).onTransactionRequested)==null?void 0:d.call(o,a)},async sendBatchTransaction(a){var m,w;const o=se({accountContract:i,executeBatchOverride:(m=t.overrides)==null?void 0:m.executeBatch,transactions:a});if(a.length===0)throw new Error("No transactions to send");const d=a[0];if(!d)throw new Error("No transactions to send");const l=E(d.chainId),y=await R({executeTx:o,options:{...t,accountContract:i,chain:l}});return I({chainId:l.id,client:t.client,contractAddress:((w=a[0])==null?void 0:w.to)??void 0,transactionHash:y.transactionHash,walletAddress:t.accountContract.address,walletType:"smart"}),y},async sendTransaction(a){var m,w,A;let o;if(n){await Ie({accountContract:i,erc20Paymaster:n,options:t});const h=async()=>({paymaster:n.paymasterAddress,paymasterData:"0x"});o=((m=t.overrides)==null?void 0:m.paymaster)||h}else o=(w=t.overrides)==null?void 0:w.paymaster;a.chainId!==i.chain.id&&(i=P({address:r.address,chain:E(a.chainId),client:t.client}));const d=at({accountContract:i,executeOverride:(A=t.overrides)==null?void 0:A.execute,transaction:a}),l=E(a.chainId),y=await R({executeTx:d,options:{...t,accountContract:i,chain:l,overrides:{...t.overrides,paymaster:o}}});return I({chainId:l.id,client:t.client,contractAddress:a.to??void 0,transactionHash:y.transactionHash,walletAddress:t.accountContract.address,walletType:"smart"}),y},async signMessage({message:a}){var d;if((d=t.overrides)!=null&&d.signMessage)return t.overrides.signMessage({accountContract:i,adminAccount:t.personalAccount,factoryContract:t.factoryContract,message:a});const{smartAccountSignMessage:o}=await L(async()=>{const{smartAccountSignMessage:l}=await import("./signing-DQH2GbYp.js");return{smartAccountSignMessage:l}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return o({accountContract:i,factoryContract:t.factoryContract,message:a,options:t})},async signTypedData(a){var d;if((d=t.overrides)!=null&&d.signTypedData)return t.overrides.signTypedData({accountContract:i,adminAccount:t.personalAccount,factoryContract:t.factoryContract,typedData:a});const{smartAccountSignTypedData:o}=await L(async()=>{const{smartAccountSignTypedData:l}=await import("./signing-DQH2GbYp.js");return{smartAccountSignTypedData:l}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return o({accountContract:i,factoryContract:t.factoryContract,options:t,typedData:a})},sendCalls:async a=>{const{inAppWalletSendCalls:o}=await L(async()=>{const{inAppWalletSendCalls:w}=await import("./in-app-wallet-calls-CHSckKlf.js");return{inAppWalletSendCalls:w}},__vite__mapDeps([8,1,9])),d=a.calls[0];if(!d)throw new Error("No calls to send");const l=d.client,y=d.chain||a.chain,m=await o({account:r,calls:a.calls});return{chain:y,client:l,id:m}},getCallsStatus:async a=>{const{inAppWalletGetCallsStatus:o}=await L(async()=>{const{inAppWalletGetCallsStatus:d}=await import("./in-app-wallet-calls-CHSckKlf.js");return{inAppWalletGetCallsStatus:d}},__vite__mapDeps([8,1,9]));return o(a)},getCapabilities:async a=>({[a.chainId??1]:{atomic:{status:"supported"},paymasterService:{supported:e??!1}}})};return r}async function Ie(t){var l;const{accountContract:n,erc20Paymaster:e,options:i}=t,r=e.tokenAddress,s=P({address:r,chain:n.chain,client:n.client});if(await Nt({contract:s,owner:n.address,spender:e.paymasterAddress})>0n)return;const a=Ht({amountWei:ae-1n,contract:s,spender:e.paymasterAddress}),o=await _t({from:n.address,transaction:a}),d=at({accountContract:n,executeOverride:(l=i.overrides)==null?void 0:l.execute,transaction:o});await R({executeTx:d,options:{...i,overrides:{...i.overrides,tokenPaymaster:void 0}}})}function Ve(t){const{creationOptions:n,connectionOptions:e,chain:i}=t,r={address:tt(e.personalAccount.address),async onTransactionRequested(s){var c,a;return(a=(c=e.personalAccount).onTransactionRequested)==null?void 0:a.call(c,s)},async sendTransaction(s){var l,y,m,w;const c={chain:E(s.chainId),client:e.client,data:s.data,eip712:s.eip712,to:s.to??void 0,value:s.value??0n};let a=await Rt({account:r,transaction:c});if(t.sponsorGas&&!a.paymaster){const A=await bt({options:{bundlerUrl:(l=n.overrides)==null?void 0:l.bundlerUrl,chain:i,client:e.client,entrypointAddress:(y=n.overrides)==null?void 0:y.entrypointAddress},transaction:a});a={...a,...A}}const o=await kt({account:r,chainId:i.id,eip712Transaction:a}),d=await St({options:{bundlerUrl:(m=n.overrides)==null?void 0:m.bundlerUrl,chain:i,client:e.client,entrypointAddress:(w=n.overrides)==null?void 0:w.entrypointAddress},signedTransaction:o,transaction:a});return I({chainId:i.id,client:e.client,contractAddress:s.to??void 0,transactionHash:d.transactionHash,walletAddress:r.address,walletType:"smart"}),{chain:i,client:e.client,transactionHash:d.transactionHash}},async signMessage({message:s}){return e.personalAccount.signMessage({message:s})},async signTypedData(s){const c=Ct(s);return e.personalAccount.signTypedData(c)},sendCalls:async s=>{const{inAppWalletSendCalls:c}=await L(async()=>{const{inAppWalletSendCalls:y}=await import("./in-app-wallet-calls-CHSckKlf.js");return{inAppWalletSendCalls:y}},__vite__mapDeps([8,1,9])),a=s.calls[0];if(!a)throw new Error("No calls to send");const o=a.client,d=a.chain||s.chain,l=await c({account:r,calls:s.calls});return{chain:d,client:o,id:l}},getCallsStatus:async s=>{const{inAppWalletGetCallsStatus:c}=await L(async()=>{const{inAppWalletGetCallsStatus:a}=await import("./in-app-wallet-calls-CHSckKlf.js");return{inAppWalletGetCallsStatus:a}},__vite__mapDeps([8,1,9]));return c(s)},getCapabilities:async s=>({[s.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:t.sponsorGas??!1}}})};return r}async function R(t){var i,r,s;const{executeTx:n,options:e}=t;try{const c=await Pe({accountContract:e.accountContract,adminAddress:e.personalAccount.address,factoryContract:e.factoryContract,overrides:e.overrides,sponsorGas:e.sponsorGas,transaction:n}),a=await De({adminAccount:e.personalAccount,chain:e.chain,client:e.client,entrypointAddress:(i=e.overrides)==null?void 0:i.entrypointAddress,userOp:c}),o={bundlerUrl:(r=e.overrides)==null?void 0:r.bundlerUrl,chain:e.chain,client:e.client,entrypointAddress:(s=e.overrides)==null?void 0:s.entrypointAddress},d=await Et({options:o,userOp:a}),l=await ve({...o,userOpHash:d});return I({chainId:e.chain.id,client:e.client,contractAddress:await x(n.to??void 0),transactionHash:l.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),{chain:e.chain,client:e.client,transactionHash:l.transactionHash}}catch(c){throw Ft(c)&&It({chainId:e.chain.id,client:e.client,contractAddress:await x(n.to??void 0),error:c,transactionValue:await x(n.value),walletAddress:e.accountContract.address}),c}finally{st(e.accountContract)}}async function ot(t,n,e){const i=P({address:t,chain:e,client:n});try{return await b({contract:i,method:"function entrypoint() public view returns (address)"})}catch{return}}const Re=Object.freeze(Object.defineProperty({__proto__:null,connectSmartAccount:_e,disconnectSmartAccount:Ee,getEntrypointFromFactory:ot,isSmartWallet:Vt},Symbol.toStringTag,{value:"Module"}));export{Re as i,et as p};
