const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-BtXriCNG.js","assets/main-C_x9syUL.js"])))=>i.map(i=>d[i]);
import{c as z,d as U,N as R,n as q,e as T,s as V,_ as J,D as K,f as _,h as Y,j as S,k as B,g as I,l as G,m as Q,v as X,o as Z,q as H,u as x,t as M,w as O}from"./main-C_x9syUL.js";import{U as nn,S as an}from"./rpc-B6OCClUZ.js";let g=null;const P={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function rn(a,c,t,i,n){var v,E,A;const r=await k(a,t,n),o=a.walletConnect;let{onDisplayUri:e}=o||{};const s=await U(t);!e&&n&&(e=b=>{const L=s.mobile.native||s.mobile.universal;if(!L){n(b);return}const j=Y(L,b).redirect;n(j)}),e&&r.events.addListener("display_uri",e);let h=o==null?void 0:o.optionalChains,d=a.chain;t==="global.safe"&&(h=$.map(T),d&&!h.includes(d)&&(d=void 0));const{chains:u,rpcMap:C}=tn({chain:d,client:a.client,optionalChains:h});await r.connect({...o!=null&&o.pairingTopic?{pairingTopic:o==null?void 0:o.pairingTopic}:{},namespaces:{[R]:{chains:u,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:C}}}),W(u.map(w=>Number(w.split(":")[1])),i);const l=((v=u[0])==null?void 0:v.split(":")[1])||1,f=q(l),m=(await r.request({method:"eth_requestAccounts",params:[]},`eip155:${f}`))[0];if(!m)throw new Error("No accounts found on provider.");const p=a.chain&&a.chain.id===f?a.chain:T(f);if(a){const w={chain:a.chain,optionalChains:(E=a.walletConnect)==null?void 0:E.optionalChains,pairingTopic:(A=a.walletConnect)==null?void 0:A.pairingTopic};i&&V(i,t,w)}return e&&r.events.removeListener("display_uri",e),F(m,p,r,c,i,a.client,s,n)}async function on(a,c,t,i,n){var l,f,y,m,p;const r=i?await z(i,t):null,o=await U(t),e=await k(r?{chain:r.chain,client:a.client,walletConnect:{optionalChains:r.optionalChains,pairingTopic:r.pairingTopic}}:{client:a.client,walletConnect:{}},t,n);if(!e.session)throw await e.disconnect(),new Error("No wallet connect session found on provider.");const s=(y=(f=(l=e.session)==null?void 0:l.namespaces)==null?void 0:f[R])==null?void 0:y.accounts,h=(m=s==null?void 0:s[0])==null?void 0:m.split(":")[2];if(!h)throw new Error("No accounts found on provider.");const d=((p=a.chain)==null?void 0:p.id)||1,u=q(d),C=a.chain&&a.chain.id===u?a.chain:T(u);return F(h,C,e,c,i,a.client,o,n)}async function k(a,c,t){var h,d,u,C;if(g)return g;const i=await U(c),n=a.walletConnect,{UniversalProvider:r}=await J(async()=>{const{UniversalProvider:l}=await import("./index.es-BtXriCNG.js").then(f=>f.k);return{UniversalProvider:l}},__vite__mapDeps([0,1]));let o=n==null?void 0:n.optionalChains,e=a.chain;c==="global.safe"&&(o=$.map(T),e&&!o.includes(e)&&(e=void 0));const s=await r.init({metadata:{description:((h=n==null?void 0:n.appMetadata)==null?void 0:h.description)||_().description,icons:[((d=n==null?void 0:n.appMetadata)==null?void 0:d.logoUrl)||_().logoUrl],name:((u=n==null?void 0:n.appMetadata)==null?void 0:u.name)||_().name,url:((C=n==null?void 0:n.appMetadata)==null?void 0:C.url)||_().url,redirect:{native:i.mobile.native||void 0,universal:i.mobile.universal||void 0}},projectId:(n==null?void 0:n.projectId)||K});if(s.events.setMaxListeners(Number.POSITIVE_INFINITY),c!=="walletConnect"){async function l(){var y,m,p,v;const f=((v=(p=(m=(y=s.session)==null?void 0:y.peer)==null?void 0:m.metadata)==null?void 0:p.redirect)==null?void 0:v.native)||i.mobile.native||i.mobile.universal;t&&f&&await t(f)}s.on("session_request_sent",l),s.events.addListener("disconnect",()=>{s.off("session_request_sent",l),g=null})}return g=s,s}function N({provider:a,address:c,client:t,chain:i,sessionRequestHandler:n,walletInfo:r}){return{address:I(c),async sendTransaction(e){const s=await D({provider:a,payload:{method:"eth_sendTransaction",params:[{data:e.data,from:I(c),gas:e.gas?M(e.gas):void 0,to:e.to,value:e.value?M(e.value):void 0}]},chain:`eip155:${e.chainId}`,walletInfo:r,sessionRequestHandler:n});return O({chainId:e.chainId,client:t,contractAddress:e.to??void 0,gasPrice:e.gasPrice,transactionHash:s,walletAddress:I(c),walletType:"walletConnect"}),{transactionHash:s}},async signMessage({message:e}){const s=typeof e=="string"?H(e):e.raw instanceof Uint8Array?x(e.raw):e.raw;return D({provider:a,payload:{method:"personal_sign",params:[s,this.address]},chain:`eip155:${i.id}`,walletInfo:r,sessionRequestHandler:n})},async signTypedData(e){const s=G(e),{domain:h,message:d,primaryType:u}=s,C={EIP712Domain:Q({domain:h}),...s.types};X({domain:h,message:d,primaryType:u,types:C});const l=Z({domain:h??{},message:d,primaryType:u,types:C});return await D({provider:a,payload:{method:"eth_signTypedData_v4",params:[this.address,l]},chain:`eip155:${i.id}`,walletInfo:r,sessionRequestHandler:n})}}}async function D(a){var s,h,d,u;const{provider:c,payload:t,chain:i,walletInfo:n,sessionRequestHandler:r}=a,o=c.request(t,i),e=((u=(d=(h=(s=c.session)==null?void 0:s.peer)==null?void 0:h.metadata)==null?void 0:d.redirect)==null?void 0:u.native)||n.mobile.native||n.mobile.universal;return r&&e&&await r(e),o}function F(a,c,t,i,n,r,o,e){const s=N({address:a,chain:c,client:r,provider:t,sessionRequestHandler:e,walletInfo:o});async function h(){t.removeListener("accountsChanged",u),t.removeListener("chainChanged",C),t.removeListener("disconnect",d),await t.disconnect(),g=null}function d(){W([],n),n==null||n.removeItem(P.lastUsedChainId),h(),i.emit("disconnect",void 0)}function u(l){if(l[0]){const f=N({address:I(l[0]),chain:c,client:r,provider:t,sessionRequestHandler:e,walletInfo:o});i.emit("accountChanged",f),i.emit("accountsChanged",l)}else d()}function C(l){const f=T(q(l));i.emit("chainChanged",f),n==null||n.setItem(P.lastUsedChainId,String(l))}return t.on("accountsChanged",u),t.on("chainChanged",C),t.on("disconnect",d),t.on("session_delete",d),[s,c,h,l=>en(t,l)]}async function en(a,c){const t=c.id;try{a.setDefaultChain(`eip155:${t}`)}catch(i){const n=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(n)?new nn(i):new an(i)}}function W(a,c){c==null||c.setItem(P.requestedChains,B(a))}function tn(a){const c={},t=[];a.chain&&(c[a.chain.id]=S({chain:a.chain,client:a.client}),t.push(a.chain.id));const i=((a==null?void 0:a.optionalChains)||[]).slice(0,10);for(const n of i)c[n.id]=S({chain:n,client:a.client}),t.push(n.id);return!a.chain&&i.length===0&&(c[1]=T(1).rpc,t.push(1)),{chains:t.map(n=>`eip155:${n}`),rpcMap:c}}const $=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{on as autoConnectWC,rn as connectWC};
