import{B as C,aw as H,au as k,ab as z,ax as b,ay as V,az as O,ac as N,aA as _,at as L,aB as q,aC as U,aD as W,aE as S,aF as $,ae as j,aG as K,aH as Z,aI as w,aJ as J,aK as Q,z as Y,A as X,N as ee,r as te,a as x,O as M,P as h,aL as ne}from"./main-DAjelYsw.js";import{d as re}from"./to-serializable-transaction-DluyPVjR.js";class se extends C{constructor(t){super(`Filter type "${t}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const v=H;function ae(e){const{abi:t,args:n=[],name:s}=e,c=k(s,{strict:!1}),i=t.filter(a=>c?a.type==="function"?z(a)===s:a.type==="event"?v(a)===s:!1:"name"in a&&a.name===s);if(i.length===0)return;if(i.length===1)return i[0];let r;for(const a of i){if(!("inputs"in a))continue;if(!n||n.length===0){if(!a.inputs||a.inputs.length===0)return a;continue}if(!a.inputs||a.inputs.length===0||a.inputs.length!==n.length)continue;if(n.every((o,f)=>{const p="inputs"in a&&a.inputs[f];return p?G(o,p):!1})){if(r&&"inputs"in r&&r.inputs){const o=R(a.inputs,r.inputs,n);if(o)throw new V({abiItem:a,type:o[0]},{abiItem:r,type:o[1]})}r=a}}return r||i[0]}function G(e,t){const n=typeof e,s=t.type;switch(s){case"address":return b(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in t?Object.values(t.components).every((c,i)=>G(Object.values(e)[i],c)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(e)&&e.every(c=>G(c,{...t,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function R(e,t,n){for(const s in e){const c=e[s],i=t[s];if(c.type==="tuple"&&i.type==="tuple"&&"components"in c&&"components"in i)return R(c.components,i.components,n[s]);const r=[c.type,i.type];if(r.includes("address")&&r.includes("bytes20")?!0:r.includes("address")&&r.includes("string")?b(n[s],{strict:!1}):r.includes("address")&&r.includes("bytes")?b(n[s],{strict:!1}):!1)return r}}const B="/docs/contract/encodeEventTopics";function ie(e){var u;const{abi:t,eventName:n,args:s}=e;let c=t[0];if(n){const o=ae({abi:t,name:n});if(!o)throw new O(n,{docsPath:B});c=o}if(c.type!=="event")throw new O(void 0,{docsPath:B});const i=N(c),r=v(i);let a=[];if(s&&"inputs"in c){const o=(u=c.inputs)==null?void 0:u.filter(p=>"indexed"in p&&p.indexed),f=Array.isArray(s)?s:Object.values(s).length>0?(o==null?void 0:o.map(p=>s[p.name]))??[]:[];f.length>0&&(a=(o==null?void 0:o.map((p,m)=>Array.isArray(f[m])?f[m].map((A,y)=>P({param:p,value:f[m][y]})):typeof f[m]<"u"&&f[m]!==null?P({param:p,value:f[m]}):null))??[])}return[r,...a]}function P({param:e,value:t}){if(e.type==="string"||e.type==="bytes")return _(L(t));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new se(e.type);return q([e],[t])}function oe(e,t){if(!b(e,{strict:!1}))throw new U({address:e});if(!b(t,{strict:!1}))throw new U({address:t});return e.toLowerCase()===t.toLowerCase()}const T="/docs/contract/decodeEventLog";function ce(e){const{abi:t,data:n,strict:s,topics:c}=e,i=s??!0,[r,...a]=c;if(!r)throw new W({docsPath:T});const u=t.find(d=>d.type==="event"&&r===v(N(d)));if(!(u&&"name"in u)||u.type!=="event")throw new S(r,{docsPath:T});const{name:o,inputs:f}=u,p=f==null?void 0:f.some(d=>!("name"in d&&d.name)),m=p?[]:{},A=f.map((d,l)=>[d,l]).filter(([d])=>"indexed"in d&&d.indexed);for(let d=0;d<A.length;d++){const[l,I]=A[d],E=a[d];if(!E)throw new $({abiItem:u,param:l});m[p?I:l.name||I]=ue({param:l,value:E})}const y=f.filter(d=>!("indexed"in d&&d.indexed));if(y.length>0){if(n&&n!=="0x")try{const d=j(y,n);if(d)if(p)for(let l=0;l<f.length;l++)m[l]=m[l]??d.shift();else for(let l=0;l<y.length;l++)m[y[l].name]=d[l]}catch(d){if(i)throw d instanceof K||d instanceof Z?new w({abiItem:u,data:n,params:y,size:J(n)}):d}else if(i)throw new w({abiItem:u,data:"0x",params:y,size:0})}return{eventName:o,args:Object.values(m).length>0?m:void 0}}function ue({param:e,value:t}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?t:(j([e],t)||[])[0]}function de(e){const{abi:t,args:n,logs:s,strict:c=!0}=e,i=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return s.map(r=>{var a;try{const u=t.find(f=>f.type==="event"&&r.topics[0]===v(f));if(!u)return null;const o=ce({...r,abi:[u],strict:c});return i&&!i.includes(o.eventName)||!fe({args:o.args,inputs:u.inputs,matchArgs:n})?null:{...o,...r}}catch(u){let o,f;if(u instanceof S)return null;if(u instanceof w||u instanceof $){if(c)return null;o=u.abiItem.name,f=(a=u.abiItem.inputs)==null?void 0:a.some(p=>!("name"in p&&p.name))}return{...r,args:f?[]:{},eventName:o}}}).filter(Boolean)}function fe(e){const{args:t,inputs:n,matchArgs:s}=e;if(!s)return!0;if(!t)return!1;function c(i,r,a){try{return i.type==="address"?oe(r,a):i.type==="string"||i.type==="bytes"?_(L(r))===a:r===a}catch{return!1}}return Array.isArray(t)&&Array.isArray(s)?s.every((i,r)=>{if(i==null)return!0;const a=n[r];return a?(Array.isArray(i)?i:[i]).some(o=>c(a,o,t[r])):!1}):typeof t=="object"&&!Array.isArray(t)&&typeof s=="object"&&!Array.isArray(s)?Object.entries(s).every(([i,r])=>{if(r==null)return!0;const a=n.find(o=>o.name===i);return a?(Array.isArray(r)?r:[r]).some(o=>c(a,o,t[i])):!1}):!1}function pe(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="event")}function F(e){const{signature:t}=e;let n;return pe(t)?n=t:n=Q(t),{abiEvent:n,hash:H(n),topics:ie({abi:[n],args:e.filters})}}function le(e){const{logs:t,events:n,strict:s}=e;return de({abi:n.map(c=>c.abiEvent),logs:t,strict:s})}function me(e={}){return F({filters:e,signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function ye(e={}){return F({filters:e,signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function he(e){const{receipt:t}=e,n={...t,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs,status:t.status,to:t.to?t.to:null,transactionHash:t.transactionHash,transactionIndex:t.transactionIndex,type:t.type};return t.blobGasPrice&&(n.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(n.blobGasUsed=BigInt(t.blobGasUsed)),{...e,actualGasCost:BigInt(e.actualGasCost),actualGasUsed:BigInt(e.actualGasUsed),nonce:BigInt(e.nonce),receipt:n,userOpHash:e.userOpHash}}const Ae=()=>{const e=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296)),c=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296));return e<<BigInt(160)|t<<BigInt(128)|n<<BigInt(96)|s<<BigInt(64)|c<<BigInt(32)|i};function D(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n==null||X(n)?n:Y(n)]))}async function we(e){return g({...e,operation:"eth_sendUserOperation",params:[D(e.userOp),e.options.entrypointAddress??M]})}async function Ge(e,t){const n=await g({...e,operation:"eth_estimateUserOperationGas",params:[D(e.userOp),e.options.entrypointAddress??M,t??{}]});return{callGasLimit:h(n.callGasLimit)+ne,paymasterPostOpGasLimit:n.paymasterPostOpGasLimit!==void 0?h(n.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:n.paymasterVerificationGasLimit!==void 0?h(n.paymasterVerificationGasLimit):void 0,preVerificationGas:h(n.preVerificationGas),verificationGas:n.verificationGas!==void 0?h(n.verificationGas):void 0,verificationGasLimit:h(n.verificationGasLimit)}}async function Ie(e){const t=await g({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxFeePerGas:h(t.maxFeePerGas),maxPriorityFeePerGas:h(t.maxPriorityFeePerGas)}}async function Ee(e){var n,s;const t=await ge(e);if(t){if(t.success===!1){const i=(s=(n=le({events:[me(),ye()],logs:t.logs})[0])==null?void 0:n.args)==null?void 0:s.revertReason;if(!i)throw new Error(`UserOp failed at txHash: ${t.receipt.transactionHash}`);const r=re({data:i});throw new Error(`UserOp failed with reason: '${r.args.join(",")}' at txHash: ${t.receipt.transactionHash}`)}return t.receipt}}async function ge(e){const t=await g({operation:"eth_getUserOperationReceipt",options:e,params:[e.userOpHash]});if(t)return he(t)}async function Oe(e){const t=await g({operation:"zk_paymasterData",options:e.options,params:[e.transaction]});return{paymaster:t.paymaster,paymasterInput:t.paymasterInput}}async function Ue(e){return{transactionId:(await g({...e,operation:"tw_execute",params:[e.eoaAddress,e.wrappedCalls,e.signature,e.authorization]})).queueId}}async function xe(e){return{transactionHash:(await g({...e,operation:"tw_getTransactionHash",params:[e.transactionId]})).transactionHash}}async function Be(e){return{transactionHash:(await g({operation:"zk_broadcastTransaction",options:e.options,params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function g(e){const{options:t,operation:n,params:s}=e,c=t.bundlerUrl??ee(t.chain),r=await te(t.client)(c,{useAuthToken:!0,body:x({id:1,jsonrpc:"2.0",method:n,params:s}),headers:{"Content-Type":"application/json"},method:"POST"}),a=await r.json();if(!r.ok||a.error){let u=a.error||r.statusText;typeof u=="object"&&(u=x(u));const o=a.code||"UNKNOWN";throw new Error(`${n} error: ${u}
Status: ${r.status}
Code: ${o}`)}return a.result}export{Ie as a,Ae as b,Oe as c,Be as d,Ge as e,we as f,Ee as g,D as h,Ue as i,xe as j};
